# Vercel KV 存储配置指南

Monster Studio 后台配置保存需要持久化存储支持。在 Vercel 环境中，我们支持两种存储方式：

## 方式一：本地存储（当前默认）
- ✅ **优点**: 无需额外配置，立即可用
- ❌ **缺点**: 仅在当前浏览器中有效，不同设备间不同步
- 💡 **适合**: 开发测试、单人使用

## 方式二：Vercel KV 存储（推荐生产环境）
- ✅ **优点**: 跨设备同步，数据持久化，多用户支持
- ❌ **缺点**: 需要配置，可能产生少量费用
- 💡 **适合**: 生产环境、团队协作

## 配置 Vercel KV 存储步骤

### 1. 登录 Vercel Dashboard
访问 [vercel.com](https://vercel.com) 并登录您的账号

### 2. 进入项目设置
1. 选择您的 Monster Studio 项目
2. 点击 "Settings" 标签
3. 在左侧菜单中选择 "Storage"

### 3. 创建 KV 数据库
1. 点击 "Create Database"
2. 选择 "KV" 类型
3. 输入数据库名称（例如：`monster-studio-config`）
4. 选择区域（建议选择离用户最近的区域）
5. 点击 "Create" 创建数据库

### 4. 获取连接信息
创建完成后，Vercel 会自动生成以下环境变量：
- `KV_REST_API_URL`
- `KV_REST_API_TOKEN`
- `KV_URL`

### 5. 配置环境变量
1. 在项目设置中，选择 "Environment Variables"
2. 确认以下变量已自动添加：
   ```
   KV_REST_API_URL=https://xxx.kv.vercel-storage.com
   KV_REST_API_TOKEN=xxxxx
   ```
3. 如果没有自动添加，请手动添加这两个变量

### 6. 重新部署
1. 返回项目 "Deployments" 页面
2. 点击最新部署右侧的 "..." 菜单
3. 选择 "Redeploy" 重新部署项目

## 验证配置

部署完成后，访问后台管理界面：

1. **检查存储状态**: 在"公司信息"页面，如果配置正确，保存按钮下方会显示"已连接KV存储"
2. **测试保存功能**: 修改任意配置并保存，应该显示"配置保存成功（服务器+本地存储）"
3. **跨设备测试**: 在不同设备上登录后台，验证配置是否同步

## 费用说明

Vercel KV 存储定价（截至2024年）：
- **免费额度**: 每月30,000次读取 + 1,000次写入
- **超出费用**: 读取 $0.40/10万次，写入 $4.00/10万次
- **存储费用**: $2.00/GB/月

对于大多数个人或小型项目，免费额度完全够用。

## 故障排除

### 问题1：保存后仍显示"仅本地存储"
**原因**: KV环境变量未正确配置
**解决**: 
1. 检查环境变量是否正确设置
2. 确认变量名称无误
3. 重新部署项目

### 问题2：配置保存失败
**原因**: KV数据库连接失败
**解决**:
1. 检查KV数据库是否正常运行
2. 确认区域设置正确
3. 查看Vercel函数日志排查错误

### 问题3：配置丢失
**原因**: 可能同时使用了本地存储和KV存储
**解决**:
1. 导出当前配置作为备份
2. 清除浏览器本地存储
3. 重新配置并保存

## 备用方案

如果暂时无法配置KV存储，可以使用以下备用方案：

1. **配置导出/导入**: 定期导出配置文件作为备份
2. **Git版本控制**: 将配置文件提交到Git仓库
3. **手动同步**: 在不同设备间手动导入配置文件

## 技术支持

如果在配置过程中遇到问题，可以：

1. 查看浏览器开发者工具的Console标签，获取详细错误信息
2. 检查Vercel项目的Functions日志
3. 参考Vercel官方KV存储文档

---

**注意**: 本项目同时支持本地存储和KV存储，即使没有配置KV，后台功能依然可以正常使用。 